%% Define document class, variables and frontmatter
\documentclass{beamer}
\usepackage{tikz}
%\usepackage{tikz-qtree}
%\usepackage[latin1]{inputenc}
%\usepackage{times}
%\usepackage{tikz}
%\usepackage{verbatim}
%\usetikzlibrary{arrows,shapes}
\usetikzlibrary{trees}
\title{Technical Overview}
\def\showoutlineatsection{1}
\input{tex/beamer.tex}
%% Content pages
\section{Overview}
% Diagram or table of architecture overview.
% Read https://leanpub.com/visualising-software-architecture/read
\begin{frame}{Introduction}
  Neronet is a framework designed to facilitate the specification, submission,
  monitoring, control, analysis and management of many different computational
  experiments.

  It has three components:
  \begin{enumerate}
  \item \texttt{jobman} -- A job scheduler for Linux clusters (f. ex. SLURM,
    OGE or Jobman)
  \item \texttt{nerojob} -- a program designed to be launched by a job
    scheduler in cluster nodes to monitor, analyse and control single
    experiment jobs and their environment in tandem with \texttt{neroman}
  \item \texttt{neroman} -- a user run daemon that acts as the Neronet
    information server and user interface to provide Neronet's features
  \end{enumerate}
\end{frame}
\begin{frame}{Introduction}
  The following three slides provide a good introduction:
  \begin{enumerate}
  \item \emph{Job management} -- the associated problem domain spheres and
    how the system components are related to them
  \item \emph{Journey map} -- the journey or work flow of a typical system
    user (a computational researcher) and the steps in which the Neronet
    tools are designed to be used
  \item \emph{Basic use case} -- A sample basic system use case description
  \end{enumerate}
\end{frame}
\begin{frame}{Job management}
  \begin{figure}
  \begin{tikzpicture}[every node/.append style={align=center}]
    \begin{scope}[every path/.append style={opacity=0.6}] % [blend group = soft light]
      \fill[red]   ( 90:1.8) circle (2.3);
      \fill[green] (210:1.8) circle (2.3);
      \fill[blue]  (330:1.8) circle (2.3);
    \end{scope}
    \node at ( 90:2.8)                {Scheduling \\ \& distribution};
    \node at (210:2.8)                {State \& progress \\ communication};
    \node at (330:2.8)                {Planning \\ \& analysis};
    \node [font=\Large]               {Neronet};
    \node [font=\scriptsize] at ( 90:2.0)  {\texttt{jobman}};
    \node [font=\scriptsize] at ( 30:1.5)  {\texttt{neroman}};
    \node [font=\scriptsize] at (190:2.0)  {\texttt{nerojob}};
  \end{tikzpicture}
  \end{figure}
\end{frame}
\begin{frame}{Journey map}
  \begin{figure}
  \tikzset{
    jmi/.append style={align=center,font=\tiny,shape=circle,draw,fill=gray!30,
    minimum size=1.4cm}, jmc/.style={font=\normalsize},
    nman/.style={fill=blue!30}, nmnj/.style={fill=green!30},
    nm/.style={color=blue!100}, nj/.style={color=green!100},
    jm/.style={color=red!100}
  }
  \resizebox{0.8\columnwidth}{!}{
  \begin{tikzpicture}
    \node (00)            [jmi,jmc]          {Research \\ journey};
    \node (01) at (180:4) [jmi]              {Innovate \\ ideas};
    \node (02) at (150:4) [jmi]              {Review \\ literature};
    \node (03) at (120:4) [jmi]              {Write \\ code};
    \node (04) at ( 90:4) [jmi,nman]         {Embed \\ analytics};
    \node (05) at ( 60:4) [jmi,nman]         {Design \\ tests};
    \node (06) at ( 30:4) [jmi,nman]         {Launch \\ tests};
    \node (07) at (  0:4) [jmi,nmnj]         {Check \\ progress};
    \node (08) at (330:4) [jmi,nmnj]         {Abort \\ failures};
    \node (09) at (300:4) [jmi,nmnj]         {Collect \\ results};
    \node (10) at (270:4) [jmi,nman]         {Analyse \\ results};
    \node (12) at (225:4) [jmi]              {Publish/drop \\ results};
    \foreach \a/\b in {00/01,01/02,02/03,03/04,04/05,05/06,06/07,07/08,08/09,09/10,10/01,10/12,12/00}
      \draw [->] (\a) edge (\b);
    \node (nm) at ( 30:2) [nm]               {\texttt{neroman}};
    \node (nm) at (  0:2) [jm]               {\texttt{jobman}};
    \node (nj) at (330:2) [nj]               {\texttt{nerojob}};
  \end{tikzpicture}
  }
  \end{figure}
\end{frame}
\begin{frame}{Basic use case}
  \begin{itemize} \scriptsize
  \item \textbf{User}: A computational researcher
  \item \textbf{Goal}: To test how well a new design works with several
    different configuration options and parameter values
  \item \textbf{Preconditions}: SLURM cluster and Neronet setup, code and
    analytics developed and test inputs setup in Neronet compatible manner
  \item \textbf{Basic flow}:
    \begin{enumerate} \tiny
    \item Specify a batch of \emph{nerojobs} in the \emph{experiments Excel}
      with parameters, inputs and other configurations
    \item Run \texttt{neroman --launch 20-28} to dispatch the jobs to the
      SLURM setup with autogenerated \texttt{sbatch} scripts and arguments
    \item Receive and check progress notifications from email
    \item See near realtime updates in the \emph{results Excel} of analytics
      variable updates
    \item Receive final results data and updates to the job excel as
      configured
    \item Analyse, reiterate and/or publish results
    \end{enumerate}
  \item \textbf{Post conditions}: Computational experiments have been
    conducted in a very straightforward, effective and researcher friendly
    fashion
  \end{itemize}
\end{frame}
% \begin{columns}
% \column{0.5\textwidth}
% This is a text in first column.
% $$E=mc^2$$
% \begin{itemize}
% \item First item
% \item Second item
% \end{itemize}
% \column{0.5\textwidth}
% This text will be in the second column
% and on a second tought this is a nice looking
% layout in some cases.
% \end{columns}
% \begin{frame}{\texttt{neroman}}
%   \begin{figure}
%   \begin{tikzpicture}[sibling distance=8em,
%     every node/.style = {rounded corners, draw, align=center,
%       top color=white, bottom color=blue!20}]]
%     \node {neroman}
%       child{node{specification}}
%       child{node{monitoring}
%         child{node{logs}}
%         child{node{files}}
%         child{node{variables}}
%         child{node{autotermination}}
%       }
%       child{node{analysis}};
%   \end{tikzpicture}
%   \end{figure}
% \end{frame}
% \begin{frame}{\texttt{neroman}}
%   \begin{figure}
%   \begin{tikzpicture}
%   \tikzset{edge from parent/.style={draw,edge from parent path={(\tikzparentnode.south)-- +(0,-8pt) -| (\tikzchildnode)}}}
%   \Tree [.neroman
%     [.Planning Specification ]
%     [.Distribution Jobman ]
%     [.Communication Specification ] ]
%   \end{tikzpicture}
%   \end{figure}
% \end{frame}
% \begin{frame}{\texttt{neroman}}
%   \begin{figure}
%   \tikzstyle{every node}=[draw=black,thick,anchor=west]
%   \tikzstyle{selected}=[draw=red,fill=red!30]
%   \begin{tikzpicture}[%
%   grow via three points={one child at (0.5,-0.7) and
%   two children at (0.5,-0.7) and (0.5,-1.4)},
%   edge from parent path={(\tikzparentnode.south) |- (\tikzchildnode.west)}]
%   \node {texmf}
%     child { node {doc}}   
%     child { node [selected] {tex}
%       child { node {generic}}
%       child { node {plain}}
%     }
%     child [missing] {}
%     child [missing] {}
%     child { node {texdoc}};
%   \node at {foo}
%     child { node {bar}};
%   \end{tikzpicture}
%   \end{figure}
% \end{frame}
% \begin{frame}{Job management}
%   \tikzstyle{format} = [draw, thin, fill=blue!20]
%   \tikzstyle{medium} = [ellipse, draw, thin, fill=green!20, minimum height=2.5em]
%   \begin{figure}
%   \begin{tikzpicture}[node distance=3cm, auto,>=latex', thick]
%       % We need to set at bounding box first. Otherwise the diagram
%       % will change position for each frame.
%       \path[use as bounding box] (-1,0) rectangle (10,-2);
%       \path[->]<1-> node[format] (tex) {.tex file};
%       \path[->]<2-> node[format, right of=tex] (dvi) {.dvi file}
%                     (tex) edge node {\TeX} (dvi);
%       \path[->]<3-> node[format, right of=dvi] (ps) {.ps file}
%                     node[medium, below of=dvi] (screen) {screen}
%                     (dvi) edge node {dvips} (ps)
%                           edge node[swap] {xdvi} (screen);
%       \path[->]<4-> node[format, right of=ps] (pdf) {.pdf file}
%                     node[medium, below of=ps] (print) {printer}
%                     (ps) edge node {ps2pdf} (pdf)
%                          edge node[swap] {gs} (screen)
%                          edge (print);
%       \path[->]<5-> (pdf) edge (screen)
%                           edge (print);
%       \path[->, draw]<6-> (tex) -- +(0,1) -| node[near start] {pdf\TeX} (pdf);
%   \end{tikzpicture}
%   \end{figure}
% \end{frame}
\section{Components}
\begin{frame}{Components}
  \begin{itemize}
  \item Both \texttt{neroman} and \texttt{nerojob} are Python programs run
    with just the researcher's privileges on any modern *nix
  \item SSH is used for intercomponent communication (user's existing ssh
    keys, ssh configs and privileges are used)
    \begin{itemize}
    \item \texttt{neroman} and \texttt{nerojob} exchange data and files
      via their CLI and Python interfaces
    \item \texttt{neroman} and \texttt{nerojob} communicate with the
      \texttt{jobman} setup using their APIs and/or CLIs
    \end{itemize}
  \item The system is ment to be very easy to setup, lightweight and the
    usability good for several types of uses.
  \end{itemize}
\end{frame}
\begin{frame}{Communication}
  \begin{figure}
  \tikzset{
    ncmp/.style={align=center,font=\small,shape=circle,draw,minimum size=3cm},
    ngw/.style={align=center,font=\tiny,shape=circle,draw,minimum size=2cm},
    ndom/.style={align=left}
  }
  \resizebox{0.8\columnwidth}{!}{
    \begin{tikzpicture}
      \draw[dashed] ( 0, 6  ) rectangle (11,11);
      \draw[dashed] ( 0, 0  ) rectangle (11, 5);
      \node (ln) at ( 2,10  ) [ndom]               {Local network};
      \node (ln) at ( 2, 4  ) [ndom]               {Cluster network};
      \node (nm) at ( 6, 9  ) [ncmp,fill=blue!30]  {\texttt{neroman}};
      \node (sj) at ( 8, 2  ) [ncmp,fill=red!30]   {\texttt{jobman}};
      \node (nj) at ( 4, 2  ) [ncmp,fill=green!30] {\texttt{nerojob}};
      \node (gw) at ( 6, 5.5) [ngw,fill=gray!30]   {SSH \\ gateway};
      \foreach \a/\b in {nm/gw,gw/nj,gw/sj,nj/sj}
        \draw [<->] (\a) edge (\b);
    \end{tikzpicture}
  }
  \end{figure}
\end{frame}
\begin{frame}{\texttt{jobman}}
  % Description of the component its responsibilities, interfaces, and what
  % are the used frameworks and technologies.
  \begin{itemize}
  \item Neronet is ment to work with standard job scheduling systems for Linux
    clusters. Here \texttt{jobman} refers to all or any of SLURM, OGE, Jobman.
  \item Each has both CLI and API interfaces and at least one of them is
    expected to be presetup by research systems administrators.
  \item SLURM is currently used by Triton and CSC. OGE has been used a lot
    in the past worldwide. Jobman could be easily setup for the gpu cluster
    used by deep learning researchers at Aalto.
  \end{itemize}
\end{frame}
\begin{frame}{\texttt{neroman}}
  % Description of the component its responsibilities, interfaces, and what
  % are the used frameworks and technologies.
  \begin{itemize}
  \item A daemon administered and configured by the researcher herself
  \item Should be run on a system with two way SSH access to the cluster nodes
  \item Key functionality
    \begin{itemize}
    \item Facilitate and standardize experiment specification
    \item Batch submit experiment jobs to a \texttt{jobman} with autogenerated
      job scripts (eg. \texttt{sbatch})
    \item Send email notifications with progress data
    \item Facilitate monitoring and control of running jobs
    \item Autocollect key job results into a researcher specifiable format
      (f. ex. Excel)
    \item Facilitate experiment analysis and history management
    \item Lightweight and extendable with custom functionality
    \item Configurable via YAML files
    \end{itemize}
  \end{itemize}
\end{frame}
\begin{frame}{\texttt{nerojob}}
  % Description of the component its responsibilities, interfaces, and what
  % are the used frameworks and technologies.
  \begin{itemize}
  \item A program ment to be started by a \texttt{jobman} on any modern *nix
    (cluster nodes) on job launch
  \item Key functionality
    \begin{itemize}
    \item Fetch and send computing environment information to \texttt{neroman}
    \item Monitor experiment job progress (parse output logs and data files
      (eg. CSV, JSON))
    \item Autocollect and send information and data to \texttt{neroman}
    \item Interact with \texttt{jobman} as specified (eg. autotermination based
      on poor experiment progress)
    \item Lightweight and extendable with custom functionality
    \item Configurable via YAML files
    \end{itemize}
  \end{itemize}
\end{frame}
% \section{Views}
% \begin{frame}{View 1}
%   An enlightning view.
%   % Read https://leanpub.com/visualising-software-architecture/read
% \end{frame}
% \begin{frame}{View 2}
%   Another enlightning view.
%   % Read https://leanpub.com/visualising-software-architecture/read
% \end{frame}
% \begin{frame}{View 3}
%   Yet another enlightning view.
%   % Read https://leanpub.com/visualising-software-architecture/read
% \end{frame}
\section{Remarks}
\begin{frame}{Remarks}
  \begin{itemize}
  \item A server (\texttt{neroman} daemon) per user approach is chosen because
    \begin{itemize}
    \item easy minimalist setup (easy to try)
    \item no need for special privileges
    \item fully customizable by the user herself
    \end{itemize}
  \item SSH is used because
    \begin{itemize}
    \item it is an existing standard in most modern research systems and
      clusters
    \item user's existing ssh keys and configs provide an easy and
      effective way to provide safe networking
    \item no need for network, port routing or privileges adjustments
    \end{itemize}
  \item Python 3 is used because
    \begin{itemize}
    \item available in most modern *nix systems
    \item has good support for the system's needs
    \item it is easy to learn and familiar to most computational researchers
    \item Many research libraries use it (Scipy, Numpy, Theano, Lasange,
      Pylearn, Blocks)
    \end{itemize}
  \end{itemize}
\end{frame}
% \section{Used languages}
% \begin{frame}{Python 3}
%   Python is the main language to use Lasange, Pylearn2, Theano and Django
% \end{frame}
% \begin{frame}{C++}
%   Main language to use Torch framework.
% \end{frame}
% \begin{frame}{Qt}
%   Optionally can be used to create a user friendly GUI. Can also be used to launch python scripts.
% \end{frame}
% \section{Used libraries}
% \begin{frame}{Django}
%   The framework used to create the web interface for the system.
% \end{frame}
% \begin{frame}{Theano}
%   Main tool to train neural networks, most libraries are built onto this library.
%   % Read https://leanpub.com/visualising-software-architecture/read
% \end{frame}
% \begin{frame}{Torch}
%   Another popular deep leaning framework we plan to support.
% \end{frame}
\end{document}